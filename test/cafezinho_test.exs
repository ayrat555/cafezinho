defmodule CafezinhoTest do
  use ExUnit.Case
  doctest Cafezinho

  describe "keypair_from_seed/1" do
    test "generates a keypair from seed" do
      seed =
        <<97, 206, 5, 203, 195, 215, 216, 130, 251, 253, 131, 27, 120, 106, 246, 46, 225, 5, 36,
          46, 60, 19, 106, 211, 197, 217, 46, 162, 244, 214, 170, 41>>

      assert {:ok,
              {<<198, 232, 50, 77, 218, 187, 252, 50, 14, 212, 55, 74, 4, 52, 81, 81, 136, 110,
                 204, 142, 139, 193, 20, 18, 152, 167, 102, 183, 183, 160, 42, 244>>,
               <<97, 206, 5, 203, 195, 215, 216, 130, 251, 253, 131, 27, 120, 106, 246, 46, 225,
                 5, 36, 46, 60, 19, 106, 211, 197, 217, 46, 162, 244, 214, 170, 41, 198, 232, 50,
                 77, 218, 187, 252, 50, 14, 212, 55, 74, 4, 52, 81, 81, 136, 110, 204, 142, 139,
                 193, 20, 18, 152, 167, 102, 183, 183, 160, 42,
                 244>>}} ==
               Cafezinho.keypair_from_seed(seed)
    end

    test "fails if seed of wrong size" do
      assert {:error, :wrong_seed_size} == Cafezinho.keypair_from_seed(<<>>)
    end
  end

  describe "sign/2" do
    test "signs data with private key" do
      assert {:ok,
              <<127, 197, 97, 134, 173, 80, 168, 105, 238, 17, 113, 96, 135, 38, 205, 37, 126, 94,
                197, 190, 190, 53, 212, 175, 206, 130, 160, 9, 169, 139, 109, 178, 50, 46, 3, 175,
                95, 52, 58, 247, 167, 250, 93, 129, 147, 125, 211, 78, 34, 42, 77, 183, 70, 106,
                150, 31, 56, 209, 127, 105, 231, 48, 170,
                1>>} =
               Cafezinho.sign(
                 "hello",
                 <<97, 206, 5, 203, 195, 215, 216, 130, 251, 253, 131, 27, 120, 106, 246, 46, 225,
                   5, 36, 46, 60, 19, 106, 211, 197, 217, 46, 162, 244, 214, 170, 41, 198, 232,
                   50, 77, 218, 187, 252, 50, 14, 212, 55, 74, 4, 52, 81, 81, 136, 110, 204, 142,
                   139, 193, 20, 18, 152, 167, 102, 183, 183, 160, 42, 244>>
               )
    end

    test "fails to sign is a private key is invalid" do
      assert {:error, :wrong_secret_key_size} =
               Cafezinho.sign(
                 "hello",
                 <<97>>
               )
    end
  end
end
